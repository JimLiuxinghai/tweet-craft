# Notion 集成功能使用指南

## 功能概述

Tweet Craft 现已支持 Notion 集成功能，允许您将推文直接保存到 Notion 数据库中，替代 Twitter 原生书签功能。

## 功能特性

- ✅ **一键保存**: 直接在推文界面上点击"保存到Notion"按钮
- ✅ **完整信息**: 自动提取推文内容、作者、时间、链接等完整信息
- ✅ **智能分类**: 基于内容自动生成标签（技术、学习、资讯等）
- ✅ **重复检查**: 自动检测是否已保存过相同推文
- ✅ **状态管理**: 支持已读/未读状态管理
- ✅ **批量操作**: 支持线程推文的批量保存
- ✅ **错误处理**: 完善的错误处理和重试机制

## 使用前准备

### 1. 创建 Notion 集成

1. 访问 [Notion 开发者页面](https://www.notion.so/my-integrations)
2. 点击 "+ New integration"
3. 填写集成信息：
   - **Name**: Tweet Craft
   - **Associated workspace**: 选择您的工作空间
   - **Capabilities**: 启用 "Read content" 和 "Insert content"
4. 点击 "Submit"
5. 复制 "Internal Integration Token"（这是您的访问令牌）

### 2. 配置扩展

1. 在浏览器中加载 Tweet Craft 扩展
2. 点击扩展图标打开弹出窗口
3. 点击 "Notion 设置" 按钮
4. 点击 "连接 Notion" 按钮进行 OAuth 认证
5. 创建或选择数据库来保存推文

## 使用方法

### 保存推文

1. 在 Twitter/X 上浏览推文
2. 在每条推文的操作栏中找到 "保存到Notion" 按钮
3. 点击按钮即可保存到 Notion

### 数据库结构

推文将保存到 Notion 数据库中，包含以下字段：

- **标题**: 推文内容的前100个字符
- **内容**: 完整推文内容
- **作者**: 推文作者姓名
- **作者用户名**: @用户名
- **推文链接**: 推文原始链接
- **发布时间**: 推文发布时间
- **保存时间**: 保存到Notion的时间
- **标签**: 自动生成的分类标签
- **类型**: 推文类型（原创/转推/引用/回复）
- **优先级**: 高/中/低
- **包含图片/视频/链接**: 媒体内容标识
- **点赞/转推/回复数**: 互动统计数据
- **状态**: 待阅读/已阅读/已归档

### 设置选项

- **自动标签**: 基于推文内容自动生成标签
- **默认标签**: 自定义默认标签
- **媒体处理**: 选择如何处理媒体文件
- **重复检查**: 避免保存重复推文
- **同步间隔**: 自动同步频率设置

## 优势对比

### 相比 Twitter 书签

| 功能 | Twitter 书签 | Notion 集成 |
|------|-------------|-------------|
| 搜索功能 | 基础 | 强大全文搜索 |
| 分类整理 | 无 | 多维度标签分类 |
| 数据导出 | 不支持 | 支持多种格式导出 |
| 团队协作 | 不支持 | 支持数据库共享 |
| 自定义字段 | 不支持 | 完全自定义 |
| 高级筛选 | 基础 | 复杂筛选和视图 |

### 数据管理能力

- **强大的搜索**: Notion 的全文搜索和组合筛选
- **灵活分类**: 多标签系统和属性分类
- **数据关联**: 可与其他 Notion 页面关联
- **模板系统**: 自定义显示模板
- **API 支持**: 可通过 API 进行二次开发

## 故障排除

### 常见问题

**Q: 连接失败怎么办？**
A: 请检查：
1. Notion 集成是否正确创建
2. 访问令牌是否有效
3. 网络连接是否正常

**Q: 保存推文失败？**
A: 可能原因：
1. 数据库未正确配置
2. 推文内容格式异常
3. Notion API 限制

**Q: 找不到保存按钮？**
A: 请确保：
1. 扩展已正确安装并启用
2. 在 Twitter/X 域名下使用
3. 刷新页面重试

### 错误代码说明

- **UNAUTHORIZED**: 认证失败，请重新连接
- **RATE_LIMITED**: 请求过于频繁，请稍后重试
- **VALIDATION_ERROR**: 数据格式错误，检查推文内容
- **NETWORK_ERROR**: 网络连接失败

## 开发说明

### 技术架构

- **客户端**: 基于 Notion API v2022-06-28
- **认证**: OAuth 2.0 流程
- **数据格式**: 标准 Notion 数据库格式
- **错误处理**: 多层错误处理和重试机制

### 文件结构

```
lib/notion/
├── client.ts          # Notion API 客户端
├── auth.ts           # 认证管理
├── types.ts          # 类型定义
├── button-manager.ts # 按钮管理
├── tweet-extractor.ts # 推文数据提取
└── error-handler.ts  # 错误处理
```

### 扩展权限

扩展需要以下权限：
- `storage`: 存储配置信息
- `activeTab`: 访问当前标签页
- `identity`: OAuth 认证
- `host_permissions`: 访问 Twitter 和 Notion API

## 更新日志

### v1.0.0
- ✅ 初始 Notion 集成功能
- ✅ 推文保存到数据库
- ✅ 自动标签生成
- ✅ 重复检查机制
- ✅ 错误处理系统

## 反馈与支持

如果遇到问题或有改进建议，请：

1. 查看 GitHub Issues 页面
2. 描述问题和复现步骤
3. 提供控制台错误信息
4. 说明使用的浏览器和版本

---

**注意**: 这是一个开源项目，所有代码都在 GitHub 上公开，欢迎贡献和改进！